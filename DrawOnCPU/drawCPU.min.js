var d=document.querySelector("canvas"),k=d.getContext("2d");document.getElementById("button");function m(a,b){this.x=void 0===a?0:a;this.y=void 0===b?0:b}function n(a){return Math.sqrt(a.x*a.x+a.y*a.y)}m.prototype.normalize=function(){var a=n(this);this.x/=a;this.y/=a};m.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};m.prototype.sub=function(a){return new m(this.x-a.x,this.y-a.y)};
function p(a,b){this.position=new m(void 0===a?0:a,void 0===b?0:b);this.s=new m;this.l=new m;this.force=new m;this.i=this.pressure=0}function t(a,b){for(var c=u,e=Math.floor((a.position.x-c.region.left)/c.g),g=Math.floor((a.position.y-c.region.bottom)/c.g),h=e-1;h<=e+1;h++)if(!(0>h||h>=c.o))for(var f=g-1;f<=g+1;f++)if(!(0>f||f>=c.u))for(var l=h+f*c.o,q=0,r=c.m[l].length;q<r;q++){var G=c.m[l][q],H=a.position.sub(G.position);n(H)>=c.g||b(G,H)}}
function v(){var a=w;this.g=.03;this.o=Math.ceil(a.width/this.g);this.u=Math.ceil(a.height/this.g);this.m=Array(this.o*this.u);this.region=a}v.prototype.clear=function(){for(var a=0,b=this.m.length;a<b;a++)this.m[a]=[]};v.prototype.add=function(a){for(var b=0,c=a.length;b<c;b++){var e=a[b];this.m[Math.floor((e.position.x-this.region.left)/this.g)+Math.floor((e.position.y-this.region.bottom)/this.g)*this.o].push(a[b])}};
function x(a,b,c){this.width=b;this.height=c;this.left=a;this.right=a+b;this.bottom=0;this.top=0+c}var y=new Stats;y.showPanel(0);document.body.appendChild(y.dom);d.width=512;d.height=512;var z=Math.min(window.innerWidth,window.innerHeight),A=(Math.max(window.innerWidth,window.innerHeight)-z)/2/z,B=0;B=window.innerWidth>window.innerHeight?A:0;var C=new function(){this.g=.03;this.alpha=4/(Math.PI*Math.pow(.03,8))},D=new m(0,-9.8),w=new x(0,1,1),u=new v,E=6*u.g*d.height,F=6*u.g,I=F*F,J=[],K=new x(.7,.25,.8);
L(new x(.05,.25,.8));L(K);var M=1,N=0,O=0,P=!1;d.addEventListener("mousedown",function(a){a.preventDefault();Q(a)});d.addEventListener("mousemove",function(a){a.preventDefault();N=a.pageX/z-B;O=1-a.pageY/z});d.addEventListener("mouseup",function(a){a.preventDefault();P=!1});d.addEventListener("touchstart",function(a){a.preventDefault();Q(a.changedTouches[0])});d.addEventListener("touchmove",function(a){a.preventDefault();a=a.changedTouches[0];N=a.pageX/z-B;O=1-a.pageY/z});
d.addEventListener("touchend",function(a){a.preventDefault();P=!1});d.addEventListener("contextmenu",function(a){a.preventDefault();M=-M});function Q(a){N=a.pageX/z-B;O=1-a.pageY/z;P=!0}function L(a){for(var b=Math.round(a.width/.02),c=Math.round(a.height/.02),e=0;e<b;e++)for(var g=0;g<c;g++)J.push(new p(a.left+.02*(e+.5),a.bottom+.02*(g+.5)))}
function R(){(function(a){for(var b={},c=0,e=a.length;c<e;b={i:b.i},c++)b.i=0,t(a[c],function(g){return function(h,f){var l=n(f);g.i+=.4*(l<C.g?C.alpha*Math.pow(C.g*C.g-l*l,3):0)}}(b)),a[c].i=b.i,a[c].pressure=Math.max(100*(a[c].i-1E3),0)})(J)}
function S(){for(var a={j:0},b=J.length;a.j<b;a={j:a.j,h:a.h},a.j++)a.h=new m,t(J[a.j],function(c){return function(e,g){if(J[c.j]!==e){var h=n(g);var f=n(g);f<C.g?(f=-6*C.alpha*Math.pow(C.g*C.g-f*f,2),f=new m(f*g.x,f*g.y)):f=new m;var l=-.4*(e.pressure/(e.i*e.i)+J[c.j].pressure/(J[c.j].i*J[c.j].i));c.h.x+=f.x*l;c.h.y+=f.y*l;l=h*h+3E-4*.03;h=J[c.j].s.sub(e.s);f=3.2/(e.i*J[c.j].i)*(g.x*f.x+g.y*f.y)/l;c.h.x+=f*h.x;c.h.y+=f*h.y}}}(a)),a.h.x+=D.x,a.h.y+=D.y,J[a.j].force.x=a.h.x,J[a.j].force.y=a.h.y}
function T(){y.begin();k.clearRect(0,0,d.width,d.height);for(var a=0;4>a;a++){u.clear();u.add(J);R();S();for(var b=0,c=J.length;b<c;b++){J[b].l.x+=.0025*J[b].force.x;J[b].l.y+=.0025*J[b].force.y;J[b].position.x+=.0025*J[b].l.x;J[b].position.y+=.0025*J[b].l.y;if(.02>J[b].position.y||.98<J[b].position.y)J[b].l.y=-J[b].l.y;if(.02>J[b].position.x||.98<J[b].position.x)J[b].l.x=-J[b].l.x;J[b].position.x=Math.min(.98,Math.max(J[b].position.x,.02));J[b].position.y=Math.min(.98,Math.max(J[b].position.y,.02));
J[b].s.x=J[b].l.x+.00125*J[b].force.x;J[b].s.y=J[b].l.y+.00125*J[b].force.y}}if(P){a=Math.floor((N-u.region.left)/u.g);b=Math.floor((O-u.region.bottom)/u.g);for(c=a-6;c<=a+6;c++)if(!(0>c||c>=u.o))for(var e=b-6;e<=b+6;e++)if(!(0>e||e>=u.u))for(var g=c+e*u.o,h=0,f=u.m[g].length;h<f;h++){var l=u.m[g][h],q=N-l.position.x,r=O-l.position.y;q*q+r*r>I||(q=new m(q,r),r=2*M,q.x*=r,q.y*=r,l.l.add(q))}k.beginPath();k.strokeStyle=1==M?"#22BC46":"#B92121";k.lineWidth=1;k.arc(N*d.width,d.height*(1-O),E,0,2*Math.PI);
k.stroke();k.closePath()}a=512/w.width;k.fillStyle="#00FFFF";b=0;for(c=J.length;b<c;b++)e=.02*a/4,g=(J[b].position.x-w.left)*a,h=512-(J[b].position.y-w.bottom)*a,k.fillStyle="hsl("+(220-J[b].pressure/100)+", 80%, 40%)",k.beginPath(),k.arc(g,h,e,0,2*Math.PI),k.fill(),k.closePath();y.end();requestAnimationFrame(T)}k.fillStyle="blue";T();
