var c=document.querySelector("canvas"),l=c.getContext("2d");document.getElementById("button");function m(a,b){this.x=void 0===a?0:a;this.y=void 0===b?0:b}function p(a){return Math.sqrt(a.x*a.x+a.y*a.y)}m.prototype.normalize=function(){var a=p(this);this.x/=a;this.y/=a};m.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};m.prototype.sub=function(a){return new m(this.x-a.x,this.y-a.y)};
function q(){var a=r.left+.02*(t+.5),b=r.bottom+.02*(u+.5);this.position=new m(void 0===a?0:a,void 0===b?0:b);this.s=new m;this.h=new m;this.force=new m;this.j=this.pressure=0}function v(a,b){for(var d=w,f=Math.floor((a.position.x-d.region.left)/d.g),h=Math.floor((a.position.y-d.region.bottom)/d.g),g=f-1;g<=f+1;g++)if(!(0>g||g>=d.o))for(var e=h-1;e<=h+1;e++)if(!(0>e||e>=d.u))for(var k=g+e*d.o,n=0,x=d.m[k].length;n<x;n++){var K=d.m[k][n],L=a.position.sub(K.position);p(L)>=d.g||b(K,L)}}
function y(){var a=z;this.g=.03;this.o=Math.ceil(a.width/this.g);this.u=Math.ceil(a.height/this.g);this.m=Array(this.o*this.u);this.region=a}y.prototype.clear=function(){for(var a=0,b=this.m.length;a<b;a++)this.m[a]=[]};y.prototype.add=function(a){for(var b=0,d=a.length;b<d;b++){var f=a[b];this.m[Math.floor((f.position.x-this.region.left)/this.g)+Math.floor((f.position.y-this.region.bottom)/this.g)*this.o].push(a[b])}};
function A(a,b,d){this.width=b;this.height=d;this.left=a;this.right=a+b;this.bottom=0;this.top=0+d}var B=new Stats;B.showPanel(0);document.body.appendChild(B.dom);for(var C=new function(){this.g=.03;this.alpha=4/(Math.PI*Math.pow(.03,8))},D=new m(0,-9.8),z=new A(0,1,1),w=new y,E=6*w.g,F=E*E,G=[],r=new A(.25,.5,.8),H=Math.round(r.width/.02),I=Math.round(r.height/.02),t=0;t<H;t++)for(var u=0;u<I;u++)G.push(new q);c.width=512;c.height=512;
var J=Math.min(window.innerWidth,window.innerHeight),M=Math.max(window.innerWidth,window.innerHeight),N=(M-J)/2/J,O,P=0;window.innerWidth>window.innerHeight?(O=0,P=N):(O=N,P=0);window.addEventListener("resize",function(){J=Math.min(window.innerWidth,window.innerHeight);M=Math.max(window.innerWidth,window.innerHeight);N=(M-J)/2/J;O;P=0;window.innerWidth>window.innerHeight?(O=0,P=N):(O=N,P=0)});var Q=0,R=0,S=!1;c.addEventListener("mousedown",function(a){a.preventDefault();T(a)});
c.addEventListener("mousemove",function(a){a.preventDefault();Q=a.pageX/J-P;R=1-a.pageY/J});c.addEventListener("mouseup",function(a){a.preventDefault();S=!1});c.addEventListener("touchstart",function(a){a.preventDefault();T(a.changedTouches[0])});c.addEventListener("touchmove",function(a){a.preventDefault();a=a.changedTouches[0];Q=a.pageX/J-P;R=1-a.pageY/J});c.addEventListener("touchend",function(a){a.preventDefault();S=!1});function T(a){Q=a.pageX/J-P;R=1-a.pageY/J;S=!0}
function U(){(function(a){for(var b={},d=0,f=a.length;d<f;b={j:b.j},d++)b.j=0,v(a[d],function(h){return function(g,e){var k=p(e);h.j+=.4*(k<C.g?C.alpha*Math.pow(C.g*C.g-k*k,3):0)}}(b)),a[d].j=b.j,a[d].pressure=Math.max(100*(a[d].j-1E3),0)})(G)}
function V(){for(var a={l:0},b=G.length;a.l<b;a={l:a.l,i:a.i},a.l++)a.i=new m,v(G[a.l],function(d){return function(f,h){if(G[d.l]!==f){var g=p(h);var e=p(h);e<C.g?(e=-6*C.alpha*Math.pow(C.g*C.g-e*e,2),e=new m(e*h.x,e*h.y)):e=new m;var k=-.4*(f.pressure/(f.j*f.j)+G[d.l].pressure/(G[d.l].j*G[d.l].j));d.i.x+=e.x*k;d.i.y+=e.y*k;k=g*g+3E-4*.03;g=G[d.l].s.sub(f.s);e=3.2/(f.j*G[d.l].j)*(h.x*e.x+h.y*e.y)/k;d.i.x+=e*g.x;d.i.y+=e*g.y}}}(a)),a.i.x+=D.x,a.i.y+=D.y,G[a.l].force.x=a.i.x,G[a.l].force.y=a.i.y}
function W(){B.begin();for(var a=0;4>a;a++){w.clear();w.add(G);U();V();for(var b=0,d=G.length;b<d;b++)G[b].h.x+=.0025*G[b].force.x,G[b].h.y+=.0025*G[b].force.y,G[b].position.x+=.0025*G[b].h.x,G[b].position.y+=.0025*G[b].h.y,G[b].position.y-.02<z.bottom&&(G[b].position.y=.02,G[b].h.y*=-1,G[b].force.y*=-1),G[b].position.y+.02>z.top&&(G[b].position.y=.98,G[b].h.y*=-1,G[b].force.y*=-1),G[b].position.x-.02<z.left&&(G[b].position.x=.02,G[b].h.x*=-1,G[b].force.x*=-1),G[b].position.x+.02>z.right&&(G[b].position.x=
.98,G[b].h.x*=-1,G[b].force.x*=-1),G[b].s.x=G[b].h.x+.00125*G[b].force.x,G[b].s.y=G[b].h.y+.00125*G[b].force.y}if(S)for(a=Math.floor((Q-w.region.left)/w.g),b=Math.floor((R-w.region.bottom)/w.g),d=a-6;d<=a+6;d++)if(!(0>d||d>=w.o))for(var f=b-6;f<=b+6;f++)if(!(0>f||f>=w.u))for(var h=d+f*w.o,g=0,e=w.m[h].length;g<e;g++){var k=w.m[h][g],n=Q-k.position.x,x=R-k.position.y;n*n+x*x>F||(n=new m(n,x),n.x*=4,n.y*=4,k.h.add(n))}l.clearRect(0,0,c.width,c.height);a=512/z.width;b=0;for(d=G.length;b<d;b++)f=.02*
a/4,h=(G[b].position.x-z.left)*a,g=512-(G[b].position.y-z.bottom)*a,l.fillStyle="hsl("+(220-G[b].pressure/100)+", 80%, 40%)",l.beginPath(),l.arc(h,g,f,0,2*Math.PI),l.fill(),l.closePath();B.end();requestAnimationFrame(W)}l.fillStyle="blue";W();
