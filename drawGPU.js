var c=document.getElementById("gl"),d=c.getContext("webgl2");function l(a,b){this.x=void 0===a?0:a;this.y=void 0===b?0:b}l.prototype.normalize=function(){var a=Math.sqrt(n(this,this));this.x/=a;this.y/=a};l.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};l.prototype.sub=function(a){return new l(this.x-a.x,this.y-a.y)};function n(a,b){return a.x*b.x+a.y*b.y}
function aa(){var a=p.left+.02*(r+.5),b=p.bottom+.02*(t+.5);this.p=new l(void 0===a?0:a,void 0===b?0:b);this.o=new l;this.j=new l;this.f=new l;this.i=this.e=0}function u(a,b){for(var e=v,g=Math.floor((a.p.x-e.region.left)/e.h),k=Math.floor((a.p.y-e.region.bottom)/e.h),h=g-1;h<=g+1;h++)if(!(0>h||h>=e.m))for(var f=k-1;f<=k+1;f++)if(!(0>f||f>=e.s))for(var q=h+f*e.m,m=0,z=e.l[q].length;m<z;m++){var N=e.l[q][m],ba=a.p.sub(N.p);b(N,ba)}}
function w(){var a=new x(1,1);this.h=.03;this.m=Math.ceil(a.width/this.h);this.s=Math.ceil(a.height/this.h);this.l=Array(this.m*this.s);this.region=a}w.prototype.clear=function(){for(var a=0,b=this.l.length;a<b;a++)this.l[a]=[]};w.prototype.add=function(a){for(var b=0,e=a.length;b<e;b++){var g=a[b];this.l[Math.floor((g.p.x-this.region.left)/this.h)+Math.floor((g.p.y-this.region.bottom)/this.h)*this.m].push(a[b])}};
function x(a,b){this.width=a;this.height=b;this.left=0;this.right=0+a;this.bottom=0;this.top=0+b}for(var A=new function(){this.h=.03;this.a=4/(Math.PI*Math.pow(.03,8))},B=new l(0,-9.8),v=new w,C=8*v.h,ca=C*C,D=[],p=new x(.5,.8),da=Math.round(p.width/.02),ea=Math.round(p.height/.02),r=0;r<da;r++)for(var t=0;t<ea;t++)D.push(new aa);c.width=512;c.height=512;
var E=Math.min(window.innerWidth,window.innerHeight),F=Math.max(window.innerWidth,window.innerHeight),G=(F-E)/2/E,H,I=0;window.innerWidth>window.innerHeight?(H=0,I=G):(H=G,I=0);window.addEventListener("resize",function(){E=Math.min(window.innerWidth,window.innerHeight);F=Math.max(window.innerWidth,window.innerHeight);G=(F-E)/2/E;H;I=0;window.innerWidth>window.innerHeight?(H=0,I=G):(H=G,I=0)});var J=0,K=0,L=!1;c.addEventListener("mousedown",function(a){a.preventDefault();M(a)});
var C=new Stats;C.showPanel(0);document.body.appendChild(C.dom);c.addEventListener("mousemove",function(a){a.preventDefault();O(a)});c.addEventListener("mouseup",function(a){a.preventDefault();L=!1});c.addEventListener("touchstart",function(a){a.preventDefault();M(a.changedTouches[0])});c.addEventListener("touchmove",function(a){a.preventDefault();O(a.changedTouches[0])});c.addEventListener("touchend",function(a){a.preventDefault();L=!1});function M(a){J=a.pageX/E-I;K=1-a.pageY/E+H;L=!0}function O(a){J=a.pageX/E-I;K=1-a.pageY/E+H}
function fa(){for(var a={},b=0,e=D.length;b<e;a={i:a.i},b++)a.i=0,u(D[b],function(g){return function(k,h){var f=Math.sqrt(n(h,h));g.i+=.4*(f<A.h?A.a*Math.pow(A.h*A.h-f*f,3):0)}}(a)),D[b].i=a.i,D[b].e=Math.max(100*(D[b].i-1E3),0)}
function ha(){for(var a={g:0},b=D.length;a.g<b;a={g:a.g},a.g++)D[a.g].f.x=0,D[a.g].f.y=0,u(D[a.g],function(e){return function(g,k){if(D[e.g]!==g){var h=Math.sqrt(n(k,k));var f=Math.sqrt(n(k,k));f<A.h?(f=-6*A.a*Math.pow(A.h*A.h-f*f,2),f=new l(f*k.x,f*k.y)):f=new l;var q=-.4*(g.e/(g.i*g.i)+D[e.g].e/(D[e.g].i*D[e.g].i));D[e.g].f.x+=f.x*q;D[e.g].f.y+=f.y*q;q=h*h+3E-4*.03;h=D[e.g].o.sub(g.o);f=3.2/(g.i*D[e.g].i)*n(k,f)/q;D[e.g].f.x+=f*h.x;D[e.g].f.y+=f*h.y}}}(a)),
D[a.g].f.x+=B.x,D[a.g].f.y+=B.y}var ia=document.getElementById("vs"),ja=document.getElementById("fs"),P=[];function Q(a,b){var e=d.createShader(a);d.shaderSource(e,b);d.compileShader(e);if(d.getShaderParameter(e,d.COMPILE_STATUS))return e;console.log(d.getShaderInfoLog(e));d.deleteShader(e)}d.enable(d.DEPTH_TEST);d.enable(d.TEXTURE_2D);var ka=Q(d.VERTEX_SHADER,ia.innerHTML),la=Q(d.FRAGMENT_SHADER,ja.innerHTML),R;var S=d.createProgram();d.attachShader(S,ka);d.attachShader(S,la);d.linkProgram(S);
d.getProgramParameter(S,d.LINK_STATUS)?R=S:(console.log(d.getProgramInfoLog(shader)),d.deleteProgram(S),R=void 0);var T=R,U=new Float32Array(2*D.length);d.clearColor(0,0,0,0);d.viewport(0,0,c.width,c.height);d.useProgram(T);var V=d.getAttribLocation(T,"position"),W=d.getAttribLocation(T,"a_texCoord");P[0]=d.getUniformLocation(T,"u_image");P[1]=d.getUniformLocation(T,"isFlip");d.uniform1i(P[0],0);d.uniform1f(P[1],-1);var X=d.createVertexArray(),ma=d.createBuffer(),na=d.STATIC_DRAW;d.bindVertexArray(X);
d.bindBuffer(d.ARRAY_BUFFER,ma);d.enableVertexAttribArray(V);d.enableVertexAttribArray(W);d.vertexAttribPointer(W,2,d.FLOAT,!1,0,0);d.vertexAttribPointer(V,2,d.FLOAT,!1,0,0);d.bufferData(d.ARRAY_BUFFER,U,na);d.bindVertexArray(null);d.bindVertexArray(X);var Y=U.length;
function Z(){C.begin();for(var a=0;4>a;a++){v.clear();v.add(D);fa();ha();for(var b=0,e=D.length;b<e;b++){D[b].j.x+=.0025*D[b].f.x;D[b].j.y+=.0025*D[b].f.y;D[b].p.x+=.0025*D[b].j.x;D[b].p.y+=.0025*D[b].j.y;if(.02>D[b].p.y||.98<D[b].p.y)D[b].j.y=-D[b].j.y;if(.02>D[b].p.x||.98<D[b].p.x)D[b].j.x=-D[b].j.x;D[b].p.x=Math.min(.98,Math.max(D[b].p.x,.02));D[b].p.y=Math.min(.98,Math.max(D[b].p.y,.02));D[b].o.x=D[b].j.x+.00125*D[b].f.x;
D[b].o.y=D[b].j.y+.00125*D[b].f.y}}if(L)for(a=Math.floor((J-v.region.left)/v.h),b=Math.floor((K-v.region.bottom)/v.h),e=a-8;e<=a+8;e++)if(!(0>e||e>=v.m))for(var g=b-8;g<=b+8;g++)if(!(0>g||g>=v.s))for(var k=e+g*v.m,h=0,f=v.l[k].length;h<f;h++){var q=v.l[k][h],m=J-q.p.x,z=K-q.p.y;m*m+z*z>ca||(m=new l(m,z),m.x*=2,m.y*=2,q.j.add(m))}d.clear(d.COLOR_BUFFER_BIT);d.uniform1i(P[0],0);d.uniform1f(P[1],1);for(a=0;a<Y;a+=2)U[a]=D[a/2].p.x,U[a+1]=D[a/2].p.y;d.bufferSubData(d.ARRAY_BUFFER,
0,U);d.drawArrays(d.POINTS,0,Y);d.flush();C.end();requestAnimationFrame(Z)}Z();
